<!DOCTYPE html>
<html lang="cn-zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>使用「Air」实现热加载，助力「Go」项目开发调试 - 艾逗笔</title>
    <meta property="og:title" content="使用「Air」实现热加载，助力「Go」项目开发调试 - 艾逗笔">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="Go 是一种静态编译型语言，写完源代码后，需要编译成二进制可执行文件，才能运行程序看到相应的效果。我们在开发 Go 程序的过程中经常需要调试，如果没有热加载功能，这将是非常痛苦的一件事。
Air 是 Go 生态中一个可以实现热加载的库，在开发 Go 项目的时候引入 Air，可以很大程度上提升开发调试的效率。
[&amp;hellip;] go get -u github.com/cosmtrek/air  &amp;hellip;">
      <meta property="og:description" content="Go 是一种静态编译型语言，写完源代码后，需要编译成二进制可执行文件，才能运行程序看到相应的效果。我们在开发 Go 程序的过程中经常需要调试，如果没有热加载功能，这将是非常痛苦的一件事。
Air 是 Go 生态中一个可以实现热加载的库，在开发 Go 项目的时候引入 Air，可以很大程度上提升开发调试的效率。
[&amp;hellip;] go get -u github.com/cosmtrek/air  &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  
  <body class="posts">
    <header class="masthead">
      <h1><a href="/">艾逗笔</a></h1>

<p class="tagline">有逻辑的脑子万里挑一。</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/categories/">分类</a></li>
  
  <li><a href="/tags/">标签</a></li>
  
  <li><a href="/works/">作品</a></li>
  
  <li><a href="/about/">关于</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>使用「Air」实现热加载，助力「Go」项目开发调试</h1>

<h3>
  2020-07-25</h3>
<hr>


      </header>



<p>Go 是一种静态编译型语言，写完源代码后，需要编译成二进制可执行文件，才能运行程序看到相应的效果。我们在开发 Go 程序的过程中经常需要调试，如果没有热加载功能，这将是非常痛苦的一件事。</p>
<p><a href="https://github.com/cosmtrek/air">Air</a> 是 Go 生态中一个可以实现热加载的库，在开发 Go 项目的时候引入 Air，可以很大程度上提升开发调试的效率。</p>
<h2 id="安装air">安装Air</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">get</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span> <span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">com</span><span style="color:#f92672">/</span><span style="color:#a6e22e">cosmtrek</span><span style="color:#f92672">/</span><span style="color:#a6e22e">air</span>
</code></pre></div><p>安装完成后，我们执行<code>air -h</code>可以看到Air的基本用法：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ air -h  
Usage of air:
  -c string
        config path
  -d    debug mode
  -v    show version
</code></pre></div><h2 id="热加载配置">热加载配置</h2>
<p>在要开发的 Go 项目目录下新建一个 <code>.air.conf</code>，写入基本的配置信息。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim" data-lang="vim"># <span style="color:#a6e22e">Config</span> <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">for</span> [<span style="color:#a6e22e">Air</span>](<span style="color:#a6e22e">https</span>:<span style="color:#e6db74">//</span><span style="color:#a6e22e">github</span>.<span style="color:#a6e22e">com</span><span style="color:#e6db74">/cosmtrek/</span><span style="color:#a6e22e">air</span>) <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">TOML</span> <span style="color:#a6e22e">format</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Working</span> <span style="color:#a6e22e">directory</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># . <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">absolute</span> <span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">please</span> <span style="color:#a6e22e">note</span> <span style="color:#a6e22e">that</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">directories</span> <span style="color:#a6e22e">following</span> <span style="color:#a6e22e">must</span> <span style="color:#a6e22e">be</span> <span style="color:#a6e22e">under</span> <span style="color:#a6e22e">root</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">root</span> = <span style="color:#e6db74">&#34;.&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">tmp_dir</span> = <span style="color:#e6db74">&#34;tmp&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>[<span style="color:#a6e22e">build</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Just</span> <span style="color:#a6e22e">plain</span> <span style="color:#a6e22e">old</span> <span style="color:#a6e22e">shell</span> <span style="color:#a6e22e">command</span>. <span style="color:#a6e22e">You</span> <span style="color:#a6e22e">could</span> <span style="color:#a6e22e">use</span> `<span style="color:#a6e22e">make</span>` <span style="color:#a6e22e">as</span> <span style="color:#a6e22e">well</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">cmd</span> = <span style="color:#e6db74">&#34;make build&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Binary</span> <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">yields</span> <span style="color:#a6e22e">from</span> `<span style="color:#a6e22e">cmd</span>`.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">bin</span> = <span style="color:#e6db74">&#34;webapi server&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Customize</span> <span style="color:#a6e22e">binary</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">full_bin</span> = <span style="color:#e6db74">&#34;APP_ENV=dev APP_USER=air ./webapi server&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Watch</span> <span style="color:#a6e22e">these</span> <span style="color:#a6e22e">filename</span> <span style="color:#a6e22e">extensions</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">include_ext</span> = [<span style="color:#e6db74">&#34;go&#34;</span>, <span style="color:#e6db74">&#34;yaml&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Ignore</span> <span style="color:#a6e22e">these</span> <span style="color:#a6e22e">filename</span> <span style="color:#a6e22e">extensions</span> <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">directories</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">exclude_dir</span> = [<span style="color:#e6db74">&#34;config&#34;</span>, <span style="color:#e6db74">&#34;tmp&#34;</span>, <span style="color:#e6db74">&#34;vendor&#34;</span>, <span style="color:#e6db74">&#34;tests&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Watch</span> <span style="color:#a6e22e">these</span> <span style="color:#a6e22e">directories</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">you</span> <span style="color:#a6e22e">specified</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">include_dir</span> = []<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Exclude</span> <span style="color:#a6e22e">files</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">exclude_file</span> = []<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">log</span> <span style="color:#a6e22e">file</span> <span style="color:#a6e22e">places</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">your</span> <span style="color:#a6e22e">tmp_dir</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">log</span> = <span style="color:#e6db74">&#34;air.log&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">It</span><span style="color:#e6db74">&#39;s not necessary to trigger build each time file changes if it&#39;</span><span style="color:#a6e22e">s</span> <span style="color:#a6e22e">too</span> <span style="color:#a6e22e">frequent</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">delay</span> = <span style="color:#ae81ff">1000</span> # <span style="color:#a6e22e">ms</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Stop</span> <span style="color:#a6e22e">running</span> <span style="color:#a6e22e">old</span> <span style="color:#a6e22e">binary</span> <span style="color:#a6e22e">when</span> <span style="color:#a6e22e">build</span> <span style="color:#a6e22e">errors</span> <span style="color:#a6e22e">occur</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">stop_on_error</span> = <span style="color:#a6e22e">true</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Send</span> <span style="color:#a6e22e">Interrupt</span> <span style="color:#a6e22e">signal</span> <span style="color:#a6e22e">before</span> <span style="color:#a6e22e">killing</span> <span style="color:#a6e22e">process</span> (<span style="color:#a6e22e">windows</span> <span style="color:#a6e22e">does</span> <span style="color:#a6e22e">not</span> <span style="color:#a6e22e">support</span> <span style="color:#a6e22e">this</span> <span style="color:#a6e22e">feature</span>)<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">send_interrupt</span> = <span style="color:#a6e22e">false</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Delay</span> <span style="color:#a6e22e">after</span> <span style="color:#a6e22e">sending</span> <span style="color:#a6e22e">Interrupt</span> <span style="color:#a6e22e">signal</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">kill_delay</span> = <span style="color:#ae81ff">500</span> # <span style="color:#a6e22e">ms</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>[<span style="color:#a6e22e">log</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Show</span> <span style="color:#a6e22e">log</span> <span style="color:#a6e22e">time</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">time</span> = <span style="color:#a6e22e">false</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>[<span style="color:#a6e22e">color</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Customize</span> <span style="color:#a6e22e">each</span> <span style="color:#a6e22e">part</span>&#39;<span style="color:#a6e22e">s</span> <span style="color:#a6e22e">color</span>. <span style="color:#a6e22e">If</span> <span style="color:#a6e22e">no</span> <span style="color:#a6e22e">color</span> <span style="color:#a6e22e">found</span>, <span style="color:#a6e22e">use</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">raw</span> <span style="color:#a6e22e">app</span> <span style="color:#a6e22e">log</span>.<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">main</span> = <span style="color:#e6db74">&#34;magenta&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">watcher</span> = <span style="color:#e6db74">&#34;cyan&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">build</span> = <span style="color:#e6db74">&#34;yellow&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">runner</span> = <span style="color:#e6db74">&#34;green&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>[<span style="color:#a6e22e">misc</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#a6e22e">Delete</span> <span style="color:#a6e22e">tmp</span> <span style="color:#a6e22e">directory</span> <span style="color:#a6e22e">on</span> <span style="color:#a6e22e">exit</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">clean_on_exit</span> = <span style="color:#a6e22e">true</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>例如我们开发的项目名称叫做 <code>webapi</code> ，在引入热加载配置之前，我们要调试程序，需要进行的操作为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e">## 编译生成可执行文件</span>
go build -o webapi main.go
<span style="color:#75715e">## 启动http服务</span>
./webapi server
</code></pre></div><p>那么我们可以在热加载文件中配置成：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[build]</span>
<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;go build -o webapi main.go&#34;</span>
<span style="color:#a6e22e">bin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;webapi server&#34;</span>
<span style="color:#a6e22e">full_bin</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;APP_ENV=dev APP_USER=air ./webapi server&#34;</span>
<span style="color:#a6e22e">include_ext</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">[&#34;go&#34;, &#34;yaml&#34;]</span>
</code></pre></div><h2 id="热加载方式运行">热加载方式运行</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">air -c .air.conf
</code></pre></div><p>我们在项目根目录下运行上面的命令，项目就启动了，<code>Air</code> 会监听项目中的 <code>.go</code>、<code>.yaml</code> 类型文件，一旦文件有修改，<code>Air</code> 会自动编译程序，并重新启动。</p>
<p>有了热加载，我们就可以专注于写业务逻辑了，预览调试起来方便的很。</p>



<img src="http://blogcdn.idoustudio.com/idoubi-mp.jpeg" width="320" alt="">



<script src="https://utteranc.es/client.js"
        repo="idoubi/idoubi.github.io"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  <footer>
  
  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="https://idoubi.cc">艾逗笔</a> 2020 | <a href="https://github.com/idoubi">Github</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

