<!DOCTYPE html>
<html lang="cn-zh">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>「微信开发」本地调试指南 - 艾逗笔</title>
    <meta property="og:title" content="「微信开发」本地调试指南 - 艾逗笔">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="在微信公众号的开发模式下，接口配置的URL必须是一个外网地址，这就要求我们在开发调试的时候，必须登录服务器去打一些断点信息，经常一言不合就出现“该公众号提供的服务出现故障，请稍后再试”这种错误提示。
我们希望能有一种解决方案，可以把一个外网地址映射到本地的开发环境，能够实时捕捉到微信公众号发送过来的调试信息，便于我们快速定位问题，完成功能开发。
网上有很多解决方案，比如使用花生壳、ngrok等产品 &amp;hellip;">
      <meta property="og:description" content="在微信公众号的开发模式下，接口配置的URL必须是一个外网地址，这就要求我们在开发调试的时候，必须登录服务器去打一些断点信息，经常一言不合就出现“该公众号提供的服务出现故障，请稍后再试”这种错误提示。
我们希望能有一种解决方案，可以把一个外网地址映射到本地的开发环境，能够实时捕捉到微信公众号发送过来的调试信息，便于我们快速定位问题，完成功能开发。
网上有很多解决方案，比如使用花生壳、ngrok等产品 &amp;hellip;">
      
    

    
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  
  <body class="posts">
    <header class="masthead">
      <h1><a href="/">艾逗笔</a></h1>

<p class="tagline">有逻辑的脑子万里挑一。</p>

      <nav class="menu">
  <input id="menu-check" type="checkbox" hidden/>
  <label id="menu-label" for="menu-check" class="unselectable" hidden>
    <span class="icon close-icon">✕</span>
    <span class="icon open-icon">☰</span>
    <span class="text">Menu</span>
  </label>
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/categories/">分类</a></li>
  
  <li><a href="/tags/">标签</a></li>
  
  <li><a href="/works/">作品</a></li>
  
  <li><a href="/about/">关于</a></li>
  
  
  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>「微信开发」本地调试指南</h1>

<h3>
  2019-04-18</h3>
<hr>


      </header>



<h2 id="前言">前言</h2>
<p>在微信公众号的开发模式下，接口配置的URL必须是一个外网地址，这就要求我们在开发调试的时候，必须登录服务器去打一些断点信息，经常一言不合就出现“该公众号提供的服务出现故障，请稍后再试”这种错误提示。</p>
<p>我们希望能有一种解决方案，可以把一个外网地址映射到本地的开发环境，能够实时捕捉到微信公众号发送过来的调试信息，便于我们快速定位问题，完成功能开发。</p>
<p>网上有很多解决方案，比如使用花生壳、ngrok等产品提供的内网穿透技术，实现外网域名到本地开发环境的映射，详情可自行Google。</p>
<p>本文介绍一种对开发者友好，相对简洁的本地开发调试方式。</p>
<h2 id="微信本地开发调试">微信本地开发调试</h2>
<ul>
<li>准备工作</li>
</ul>
<ol>
<li>一个外网域名</li>
<li>一台有公网ip的服务器</li>
</ol>
<ul>
<li>把外网域名解析到服务器</li>
</ul>
<p>例如：<code>wx.idoubi.cc 119.29.201.62</code></p>
<ul>
<li>修改服务器sshd配置</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 打开配置文件</span>
vi /etc/ssh/sshd_config

<span style="color:#75715e"># 修改配置参数</span>
GatewayPorts yes

<span style="color:#75715e"># 重启sshd服务</span>
service sshd restart
</code></pre></div><ul>
<li>本地连接服务器</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 打开终端，通过ssh隧道连接服务器</span>
ssh -NTf -R 8089:127.0.0.1:8080 root@119.29.201.62
</code></pre></div><ul>
<li>在服务器查看本地连接的端口是否已监听</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">telnet localhost <span style="color:#ae81ff">8089</span>
</code></pre></div><ul>
<li>在服务器nginx设置域名转发</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">server <span style="color:#f92672">{</span>
    listen       80;
    server_name wx.idoubi.cc;
    location / <span style="color:#f92672">{</span>
        proxy_pass      http://127.0.0.1:8089;
        proxy_set_header host $http_host;
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>在本地配置开发路径</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nginx" data-lang="nginx"><span style="color:#66d9ef">server</span> {
    <span style="color:#f92672">listen</span> <span style="color:#ae81ff">8080</span>;
    <span style="color:#f92672">server_name</span> <span style="color:#ae81ff">127</span><span style="color:#e6db74">.0.0.1</span>;
    <span style="color:#f92672">root</span> <span style="color:#e6db74">/data/php/wechat</span>;
    <span style="color:#f92672">index</span> <span style="color:#e6db74">index.html</span> <span style="color:#e6db74">index.htm</span> <span style="color:#e6db74">index.php</span>;

    <span style="color:#f92672">location</span> ~ <span style="color:#e6db74">[^/]\.php(/|$)</span> {
        <span style="color:#f92672">fastcgi_pass</span> 127.0.0.1:<span style="color:#ae81ff">9000</span>;
        <span style="color:#f92672">fastcgi_index</span> <span style="color:#e6db74">index.php</span>;
        <span style="color:#f92672">include</span> <span style="color:#e6db74">fastcgi.conf</span>;
    }
}
</code></pre></div><ul>
<li>接入调试</li>
</ul>
<p>经过上述配置，我们通过外网访问<code>http://wx.idoubi.cc/index.php</code>，就能把请求转发到本地的<code>http://127.0.0.1:8080/index.php</code>，对应的本地文件地址为<code>/data/php/wechat/index.php</code>，所以我们只需要在这个<code>index.php</code>文件中编写响应微信服务器请求的代码，就可以在本地进行微信开发调试了。</p>



<img src="http://blogcdn.idoustudio.com/idoubi-mp.jpeg" width="320" alt="">



<script src="https://utteranc.es/client.js"
        repo="idoubi/idoubi.github.io"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  <footer>
  
  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="https://idoubi.cc">艾逗笔</a> 2020 | <a href="https://github.com/idoubi">Github</a></div>
  
  </footer>
  </article>
  
  </body>
</html>

